import groovy.sql.Sql

void updateOrgs(Sql sql) {

	def insertQuery = '''\
INSERT INTO SKUNK_CAS.LDAP_ORG_STRUKTURA (
  ID_ORG,
  FAKULTA,
  SIDLO,
  DATUM_OD,
  DATUM_DO,
  IC,
  DIC,
  POID,
  SOUCAST,
  NAZEV,
  NAZEV_DLOUHY,
  NAZEV_EN,
  NAZEV_DLOUHY_EN,
  ZKRATKA,
  ZKRATKA_DLOUHA,
  ZKRATKA_EN,
  ZKRATKA_DLOUHA_EN,
  KOD_SIMS,
  CAS_DOMENA,
  CAS_IDENTIFIKACE,
  ID_ORG_NADRIZENY,
  POID_NADRIZENY,
  X_ZAZNAM_PLATNY,
  X_EXPORTOVAT_TYP,
  X_DTIME_CREATE,
  X_DTIME_UPDATE,
  X_DTIME_DELETE
)
SELECT 
  ID_ORG,
  FAKULTA,
  SIDLO,
  DATUM_OD,
  DATUM_DO,
  IC,
  DIC,
  POID,
  SOUCAST,
  NAZEV,
  NAZEV_DLOUHY,
  NAZEV_EN,
  NAZEV_DLOUHY_EN,
  ZKRATKA,
  ZKRATKA_DLOUHA,
  ZKRATKA_EN,
  ZKRATKA_DLOUHA_EN,
  KOD_SIMS,
  CAS_DOMENA,
  CAS_IDENTIFIKACE,
  LISTAGG(os.ID_ORG_NADRIZENY, ',') WITHIN GROUP ( ORDER BY ID_ORG_NADRIZENY ) AS ID_ORG_NADRIZENY, 
  LISTAGG(os.POID_NADRIZENY, ',') WITHIN GROUP ( ORDER BY ID_ORG_NADRIZENY ) AS POID_NADRIZENY,
  1 as X_ZAZNAM_PLATNY,
  'C' as X_EXPORTOVAT_TYP,
  sysdate as X_DTIME_CREATE,
  null as X_DTIME_UPDATE,
  null as X_DTIME_DELETE
FROM SKUNK_CAS.ORG_STRUKTURA os
WHERE os.ID_ORG NOT IN (SELECT los.ID_ORG FROM skunk_cas.LDAP_ORG_STRUKTURA los)
GROUP BY ID_ORG,
  FAKULTA,
  SIDLO,
  DATUM_OD,
  DATUM_DO,
  IC,
  DIC,
  POID,
  SOUCAST,
  NAZEV,
  NAZEV_DLOUHY,
  NAZEV_EN,
  NAZEV_DLOUHY_EN,
  ZKRATKA,
  ZKRATKA_DLOUHA,
  ZKRATKA_EN,
  ZKRATKA_DLOUHA_EN,
  KOD_SIMS,
  CAS_DOMENA,
  CAS_IDENTIFIKACE
;'''
		
}
